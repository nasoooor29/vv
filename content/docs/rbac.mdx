---
title: Role-Based Access Control
description: RBAC policies and permission management
---

# Role-Based Access Control (RBAC)

Visory implements a flexible RBAC system using comma-separated policy strings stored in the user's role field.

## How It Works

Each user has a `role` field containing comma-separated permission policies. When accessing protected resources, the system checks if the user has the required policy.

Example role string:
```
docker_read,docker_write,qemu_read,health_checker
```

## Available Policies

### Docker Permissions

| Policy | Description |
|--------|-------------|
| `docker_read` | View Docker containers and images |
| `docker_write` | Create Docker containers |
| `docker_update` | Start, stop, restart containers |
| `docker_delete` | Delete containers and images |

### QEMU/VM Permissions

| Policy | Description |
|--------|-------------|
| `qemu_read` | View virtual machines |
| `qemu_write` | Create virtual machines, start VMs |
| `qemu_update` | Reboot, shutdown VMs |
| `qemu_delete` | Delete virtual machines |

### System Permissions

| Policy | Description |
|--------|-------------|
| `event_viewer` | View events and monitoring |
| `event_manager` | Manage events |
| `settings_manager` | Access storage and system settings |
| `audit_log_viewer` | View audit logs |
| `health_checker` | Access health metrics |

### Administrative

| Policy | Description |
|--------|-------------|
| `user_admin` | **Full admin access** - bypasses all permission checks |

## Permission Levels

Permissions follow a logical hierarchy:

```
read → write → update → delete
```

- **read**: View resources only
- **write**: Create new resources
- **update**: Modify existing resources
- **delete**: Remove resources

## Backend Implementation

Routes are protected using the `RBAC()` middleware:

```go
// Single permission
e.GET("/api/docker/:clientId/containers", handler, RBAC(RBAC_DOCKER_READ))

// Multiple permissions (user needs at least one)
e.POST("/api/docker/:clientId/containers", handler, RBAC(RBAC_DOCKER_WRITE))
```

If a user lacks the required permission, a `403 Forbidden` error is returned.

### Admin Bypass

Users with the `user_admin` policy bypass all permission checks:

```go
func RBAC(policies ...string) echo.MiddlewareFunc {
    // user_admin bypasses all checks
    if strings.Contains(user.Role, "user_admin") {
        return next(c)
    }
    // Check for required policies...
}
```

## Frontend Implementation

### Route Protection

Routes check permissions before rendering:

```typescript
// In route component
const { hasPermission } = useUser();

if (!hasPermission('docker_read')) {
    return <Navigate to="/app" />;
}
```

### Conditional Rendering

Use the `ProtectedContent` component to conditionally show UI elements:

```tsx
import { ProtectedContent } from '@/components/protected-content';

<ProtectedContent permission="docker_write">
    <Button onClick={createContainer}>Create Container</Button>
</ProtectedContent>
```

### Permission Hooks

```typescript
import { useUser } from '@/stores/user';

function MyComponent() {
    const { hasPermission, hasAnyPermission } = useUser();
    
    // Check single permission
    if (hasPermission('docker_read')) {
        // Show docker content
    }
    
    // Check multiple permissions
    if (hasAnyPermission(['docker_read', 'qemu_read'])) {
        // Show if user has either permission
    }
}
```

## Managing User Roles

Administrators can manage user roles through the UI:

1. Navigate to **System** > **Users**
2. Click the **Manage Roles** button for a user
3. Toggle permissions using checkboxes
4. Save changes

### API Endpoint

```
PATCH /api/users/:id/role
```

Request body:
```json
{
    "role": "docker_read,docker_write,qemu_read"
}
```

## Common Role Templates

### Read-Only User
```
docker_read,qemu_read,event_viewer,health_checker
```

### Docker Operator
```
docker_read,docker_write,docker_update,docker_delete,event_viewer
```

### VM Operator
```
qemu_read,qemu_write,qemu_update,qemu_delete,event_viewer
```

### System Administrator
```
user_admin
```

### Full Operator (no user admin)
```
docker_read,docker_write,docker_update,docker_delete,qemu_read,qemu_write,qemu_update,qemu_delete,event_viewer,event_manager,settings_manager,audit_log_viewer,health_checker
```
