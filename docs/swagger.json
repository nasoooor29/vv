{"schemes":["http","https"],"swagger":"2.0","info":{"description":"Visory Management API","title":"Visory API","contact":{"name":"API Support"},"version":"1.0"},"host":"localhost:9999","basePath":"/api","paths":{"/":{"get":{"description":"simple hello world endpoint","produces":["application/json"],"tags":["general"],"summary":"hello world","responses":{"200":{"description":"OK","schema":{"type":"object","additionalProperties":{"type":"string"}}}}}},"/auth/login":{"post":{"description":"login with username/email and password","consumes":["application/json"],"produces":["application/json"],"tags":["accounts"],"summary":"login","parameters":[{"description":"User login credentials","name":"credentials","in":"body","required":true,"schema":{"$ref":"#/definitions/models.Login"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/user.User"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/models.HTTPError"}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/auth/logout":{"get":{"description":"delete the session and logout the current user","produces":["application/json"],"tags":["accounts"],"summary":"logout","responses":{"200":{"description":"OK","schema":{"type":"null"}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/auth/me":{"get":{"description":"Get current user info","produces":["application/json"],"tags":["accounts"],"summary":"my info","responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/user.GetUserAndSessionByTokenRow"}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/auth/oauth/{provider}":{"get":{"description":"initiate OAuth login flow","produces":["application/json"],"tags":["accounts"],"summary":"OAuth login","parameters":[{"type":"string","description":"OAuth provider (google, github)","name":"provider","in":"path","required":true}],"responses":{"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/auth/register":{"post":{"description":"registers a new user","consumes":["application/json"],"produces":["application/json"],"tags":["accounts"],"summary":"register","parameters":[{"description":"User registration info","name":"user","in":"body","required":true,"schema":{"$ref":"#/definitions/user.UpsertUserParams"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/user.User"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/models.HTTPError"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/docs/redoc":{"get":{"description":"serve redoc ui for api documentation","tags":["documentation"],"summary":"redoc ui","responses":{}}},"/docs/spec":{"get":{"description":"serve openapi/swagger specification in json format","produces":["application/json"],"tags":["documentation"],"summary":"openapi spec","responses":{"200":{"description":"OK","schema":{"type":"object","additionalProperties":true}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/docs/swagger":{"get":{"description":"serve swagger ui for api documentation","tags":["documentation"],"summary":"swagger ui","responses":{}}},"/health":{"get":{"description":"check database health status","produces":["application/json"],"tags":["health"],"summary":"health check","responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/database.Health"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/logs":{"get":{"description":"retrieve logs with filtering and pagination","produces":["application/json"],"tags":["logs"],"summary":"get logs","parameters":[{"type":"string","description":"Filter by service group","name":"service_group","in":"query"},{"type":"string","description":"Filter by log level","name":"level","in":"query"},{"type":"integer","description":"Page number (default 1)","name":"page","in":"query"},{"type":"integer","description":"Page size (default 20, max 100)","name":"page_size","in":"query"},{"type":"integer","description":"Number of days to filter (default 7)","name":"days","in":"query"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/models.GetLogsResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/models.HTTPError"}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/logs/cleanup":{"delete":{"description":"delete logs older than specified retention period","produces":["application/json"],"tags":["logs"],"summary":"clear old logs","parameters":[{"type":"integer","description":"Retention days (default 30)","name":"days","in":"query"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/models.ClearOldLogsResponse"}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/logs/stats":{"get":{"description":"retrieve statistics about logs","produces":["application/json"],"tags":["logs"],"summary":"get log statistics","parameters":[{"type":"integer","description":"Number of days to filter (default 7)","name":"days","in":"query"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/models.LogStatsResponse"}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/metrics":{"get":{"description":"retrieve comprehensive performance metrics","produces":["application/json"],"tags":["metrics"],"summary":"get metrics","parameters":[{"type":"integer","description":"Number of days to analyze (default 7)","name":"days","in":"query"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/models.MetricsResponse"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/models.HTTPError"}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/metrics/health":{"get":{"description":"retrieve system health metrics based on error rates","produces":["application/json"],"tags":["metrics"],"summary":"get health metrics","responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/models.HealthMetricsResponse"}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/metrics/{service}":{"get":{"description":"retrieve metrics for a specific service","produces":["application/json"],"tags":["metrics"],"summary":"get service metrics","parameters":[{"type":"string","description":"Service name","name":"service","in":"path","required":true},{"type":"integer","description":"Number of days to analyze (default 7)","name":"days","in":"query"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/models.ServiceMetricsResponse"}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/storage/devices":{"get":{"description":"get list of block storage devices","produces":["application/json"],"tags":["storage"],"summary":"list storage devices","responses":{"200":{"description":"OK","schema":{"type":"array","items":{"$ref":"#/definitions/models.StorageDevice"}}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/storage/mount-points":{"get":{"description":"get list of mount points","produces":["application/json"],"tags":["storage"],"summary":"list mount points","responses":{"200":{"description":"OK","schema":{"type":"array","items":{"$ref":"#/definitions/models.MountPoint"}}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/users":{"get":{"description":"fetch all users (admin only)","produces":["application/json"],"tags":["users"],"summary":"get all users","responses":{"200":{"description":"OK","schema":{"type":"array","items":{"$ref":"#/definitions/user.User"}}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}},"post":{"description":"create a new user (admin only)","consumes":["application/json"],"produces":["application/json"],"tags":["users"],"summary":"create new user","parameters":[{"description":"User creation info","name":"user","in":"body","required":true,"schema":{"$ref":"#/definitions/user.CreateUserParams"}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/user.User"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/models.HTTPError"}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/models.HTTPError"}},"409":{"description":"Conflict","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/users/{id}":{"get":{"description":"fetch a specific user by their ID (admin only)","produces":["application/json"],"tags":["users"],"summary":"get user by ID","parameters":[{"type":"integer","description":"User ID","name":"id","in":"path","required":true}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/user.User"}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/models.HTTPError"}},"404":{"description":"Not Found","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}},"put":{"description":"update an existing user (admin only)","consumes":["application/json"],"produces":["application/json"],"tags":["users"],"summary":"update user","parameters":[{"type":"integer","description":"User ID","name":"id","in":"path","required":true},{"description":"User update info","name":"user","in":"body","required":true,"schema":{"type":"object","properties":{"email":{"type":"string"},"role":{"type":"string"},"username":{"type":"string"}}}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/user.User"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/models.HTTPError"}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}},"delete":{"description":"delete a user by ID (admin only)","produces":["application/json"],"tags":["users"],"summary":"delete user","parameters":[{"type":"integer","description":"User ID","name":"id","in":"path","required":true}],"responses":{"204":{"description":"No Content"},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/users/{id}/role":{"patch":{"description":"update a user's role (admin only)","consumes":["application/json"],"produces":["application/json"],"tags":["users"],"summary":"update user role","parameters":[{"type":"integer","description":"User ID","name":"id","in":"path","required":true},{"description":"Role to assign","name":"role","in":"body","required":true,"schema":{"type":"object","properties":{"role":{"type":"string"}}}}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/user.User"}},"400":{"description":"Bad Request","schema":{"$ref":"#/definitions/models.HTTPError"}},"401":{"description":"Unauthorized","schema":{"$ref":"#/definitions/models.HTTPError"}},"403":{"description":"Forbidden","schema":{"$ref":"#/definitions/models.HTTPError"}},"500":{"description":"Internal Server Error","schema":{"$ref":"#/definitions/models.HTTPError"}}}}},"/websocket":{"get":{"description":"establishes websocket connection for real-time updates","tags":["websocket"],"summary":"websocket connection","responses":{}}}},"definitions":{"database.Health":{"type":"object","properties":{"app_version":{"type":"string"},"base_url":{"type":"string"},"error":{"type":"string"},"message":{"type":"string"},"stats":{"$ref":"#/definitions/database.HealthStats"},"status":{"type":"string"}}},"database.HealthStats":{"type":"object","properties":{"idle":{"type":"integer"},"in_use":{"type":"integer"},"max_idle_closed":{"type":"integer"},"max_lifetime_closed":{"type":"integer"},"open_connections":{"type":"integer"},"wait_count":{"type":"integer"},"wait_duration":{"type":"string"}}},"models.ClearOldLogsResponse":{"type":"object","properties":{"before":{"type":"string"},"message":{"type":"string"},"retention_days":{"type":"integer"}}},"models.ErrorRateByService":{"type":"object","properties":{"error_count":{"type":"integer"},"error_rate":{"type":"number"},"service_group":{"type":"string"},"total_count":{"type":"integer"}}},"models.GetLogsResponse":{"type":"object","properties":{"logs":{"type":"array","items":{"$ref":"#/definitions/models.LogResponse"}},"page":{"type":"integer"},"page_size":{"type":"integer"},"total":{"type":"integer"},"total_pages":{"type":"integer"}}},"models.HTTPError":{"type":"object","properties":{"message":{"type":"string"}}},"models.HealthMetricsResponse":{"type":"object","properties":{"alerts":{"type":"array","items":{"type":"string"}},"overall_status":{"type":"string"},"period":{"type":"string"},"services":{"type":"array","items":{"$ref":"#/definitions/models.ServiceHealth"}},"timestamp":{"type":"string"}}},"models.LogCountByHour":{"type":"object","properties":{"hour":{"type":"string"},"log_count":{"type":"integer"}}},"models.LogLevelStats":{"type":"object","properties":{"count":{"type":"integer"},"level":{"type":"string"},"percentage":{"type":"number"}}},"models.LogResponse":{"type":"object","properties":{"action":{"type":"string"},"created_at":{"type":"string"},"details":{"type":"string"},"id":{"type":"integer"},"level":{"type":"string"},"service_group":{"type":"string"},"user_id":{"type":"integer"}}},"models.LogStatsResponse":{"type":"object","properties":{"days":{"type":"integer"},"levels":{"type":"array","items":{"type":"string"}},"service_groups":{"type":"array","items":{"type":"string"}},"since":{"type":"string"},"total":{"type":"integer"}}},"models.Login":{"type":"object","required":["password","username"],"properties":{"password":{"type":"string"},"username":{"type":"string"}}},"models.MetricsPeriod":{"type":"object","properties":{"days":{"type":"integer"},"since":{"type":"string"},"until":{"type":"string"}}},"models.MetricsResponse":{"type":"object","properties":{"error_rate_by_service":{"type":"array","items":{"$ref":"#/definitions/models.ErrorRateByService"}},"log_count_by_hour":{"type":"array","items":{"$ref":"#/definitions/models.LogCountByHour"}},"log_level_distribution":{"type":"array","items":{"$ref":"#/definitions/models.LogLevelStats"}},"period":{"$ref":"#/definitions/models.MetricsPeriod"},"service_group_distribution":{"type":"array","items":{"$ref":"#/definitions/models.ServiceStats"}}}},"models.MountPoint":{"type":"object","properties":{"available":{"type":"integer"},"device":{"type":"string"},"fs_type":{"type":"string"},"path":{"type":"string"},"total":{"type":"integer"},"use_percent":{"type":"integer"},"used":{"type":"integer"}}},"models.ServiceHealth":{"type":"object","properties":{"error_count":{"type":"integer"},"error_rate":{"type":"number"},"service_group":{"type":"string"},"status":{"type":"string"},"total_count":{"type":"integer"}}},"models.ServiceMetricsResponse":{"type":"object","properties":{"days":{"type":"integer"},"error_count":{"type":"integer"},"error_rate":{"type":"number"},"level_distribution":{"type":"array","items":{"$ref":"#/definitions/models.LogLevelStats"}},"service_group":{"type":"string"},"since":{"type":"string"},"total_logs":{"type":"integer"}}},"models.ServiceStats":{"type":"object","properties":{"count":{"type":"integer"},"percentage":{"type":"number"},"service_group":{"type":"string"}}},"models.StorageDevice":{"type":"object","properties":{"mount_point":{"type":"string"},"name":{"type":"string"},"size":{"type":"string"},"size_bytes":{"type":"integer"},"type":{"type":"string"},"usage_percent":{"type":"integer"}}},"user.CreateUserParams":{"type":"object","properties":{"email":{"type":"string"},"password":{"type":"string"},"role":{"type":"string"},"username":{"type":"string"}}},"user.GetUserAndSessionByTokenRow":{"type":"object","properties":{"user":{"$ref":"#/definitions/user.User"},"user_session":{"$ref":"#/definitions/user.UserSession"}}},"user.UpsertUserParams":{"type":"object","properties":{"email":{"type":"string"},"password":{"type":"string"},"role":{"type":"string"},"username":{"type":"string"}}},"user.User":{"type":"object","properties":{"created_at":{"type":"string"},"email":{"type":"string"},"id":{"type":"integer"},"password":{"type":"string"},"role":{"type":"string"},"updated_at":{"type":"string"},"username":{"type":"string"}}},"user.UserSession":{"type":"object","properties":{"created_at":{"type":"string"},"id":{"type":"integer"},"session_token":{"type":"string"},"updated_at":{"type":"string"},"user_id":{"type":"integer"}}}}}